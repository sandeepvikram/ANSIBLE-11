#ANSIBLE DAY PRACTICE

CREATE 2 INSTANCES WITH UBUNTU 18( ANY VERSION IS FINE BUT HERE WE TOOK 18) 
LOGIN INTO THE SERVER
COMMANDS:
   ''' 
     sudo vi /etc/ssh/sshd_config
     PASSWORD AUTHENTICATION YES      (CHANGE PASSWD AUTH FROM NO TO YES)
     service sshd restart
   '''
NOW CREATE USER
'''
  sudo adduser devops                  (GIVE PASSWD AND ENTER FEW TIMES AND USER IS CREATED)
  sudo visudo                          ( CHANGE PERSMISSIONS TO GIVE ACCESS devops USER TO ACCESS  INSTANCE WITHOUT PEM FILE)
   '''     
     devops ALL=(ALL:ALL) NOPASSWD:ALL    (ADD THIS COMMAND IN VISUDO IN SUDO COMMAND, WE ADD THIS COMMAND TO HAVE DEVOPS USER TO PERFORM COMMANDS WITHOUT THE PASSWORD AUTH EVERYTIME)

 NOW YOU CAN LOGIN TO INSTANCE WITH COMMAND
     ''' ssh devops@IP'''

 NOW DO THIS FOR NODE 1 AND NODE 2
 SO WE HAVE TOTAL 3 DEVOPS USERS IN ONE ANSIBLE CONTROL NODE AND 2 NODES

 ##NOW THAT WE CONFIGURED ALL THE NODES WE HAVE TO INSTALL ANSIBLE ON ANSIBLE CONTROL NODE###
    '''python --version'''
 ANSIBLE INSTALLATION COMMANDS FOR UBUNTU (SEARCH FOR OS SPECIFIC INSTALLATION )   
    '''$ sudo apt update
       $ sudo apt install software-properties-common
       $ sudo add-apt-repository --yes --update ppa:ansible/ansible
       $ sudo apt install ansible 

       ansible --version


  LOOK ONCE AT ANSIBLE CONFIG FILE
    ''' sudo vi  /etc/ansible/ansible.cfg'''


  NOW LETS CREATE A KEYS FOR ACCESSING NODES FROM ANSIBLE CONTROL NODE(ACN) 
     '''ssh-keygen'''
  COPY THE KEYGEN KEY PUBLIC KEY TO NODE WITH THEIR PRIVATE IP
    ''' ssh-copy-id devopss@IP
  WE DO THIS BECAUSE IT IS SECURE AND IF YOU OBSERVE WE DIDNT METIONED DEVOPSS WHILE COPYING ID TO NODE BECAUSE IT DIRECTLY RECOGNISES WE ARE DEVOPSS USER SO WE DONT DO NEED TO SPECIFY IT.

  CREATE HOSTS FILE AND GIVE PRIVATE IP's OF ALL THE NODES     

  ALWAYS RUN THE MANUAL STEPS BEFORE GOING TO RUN THE COMMANDS IN ANSIBLE (refer HEREhttps://directdevops.blog/2021/05/11/devops-classroom-series-11-may-2021/ )

  ###DAY 2###       
In this we will try to create a HOSTS FILE and create yml file WITH ANSIBLE COMMANDS

IN THE LINE 47 WE SEE A LINK TO INSTALL A SPRING BOOT APPLICATION NAMED SPRING PET CLINIC, AFTER WE HAVE EXECUTED MANUAL STEPS.

NOW WE DO WRITE A PART OF ANSIBLE PLAYBOOK AND EXECUTE IT. 
(REFER 
https://github.com/sandeepvikram/ANSIBLE-11/commit/3bc09ebcf8bf8c963c804ca451d990e9732e738a)
'''
---
- name: Deploy Spring Pet Clinic as a service
  hosts: all
  become: yes
  tasks:
    - name: Update Ubuntu packages and install open-JDK11
      apt:
        name: openjdk-11-jdk
        update_cache: yes
        state: present
    - name: Create a Spring pet Clinic Directory
      anisble.builtin.file:
        path: /usr/share/springpetclinic
        state: directory
    - name: Download SpringPet Clinic
      get_url:
        url:   https://referenceapplicationskhaja.s3-us-west-2.amazonaws.com/spring-petclinic-2.4.2.jar
        dest: /usr/share/springpetclinic/

  '''

